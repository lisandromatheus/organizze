<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Menu Organizze - Versão Final</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Outfit"', 'sans-serif'],
                        serif: ['"Playfair Display"', 'serif'],
                    },
                    animation: {
                        'float-slow': 'float 8s ease-in-out infinite',
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0) scale(1)' },
                            '50%': { transform: 'translateY(-20px) scale(1.05)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #121212; color: #e2e8f0; overflow-x: hidden; }
        
        /* Glassmorphism */
        .glass-panel {
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        @media (min-width: 768px) { .glass-panel { background: rgba(18, 18, 18, 0.8); } }
        
        .input-dark {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white; transition: all 0.2s;
        }
        .input-dark:focus { border-color: rgba(255,255,255,0.3); outline: none; background: rgba(255,255,255,0.08); }

        .phone-frame {
            width: 350px; height: 720px; background: #000;
            border-radius: 40px; border: 8px solid #2d2d2d;
            box-shadow: 0 50px 100px -20px rgba(0,0,0,0.9);
            position: relative; overflow: hidden; z-index: 10; margin: 0 auto;
        }
        @media (min-width: 768px) { .phone-frame { width: 375px; height: 780px; } }

        .notch {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 140px; height: 28px; background: #2d2d2d;
            border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; z-index: 50;
        }
        .orb { position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.4; z-index: 0; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        
        #qr-hidden { position: absolute; visibility: hidden; pointer-events: none; }

        /* MODAL DE COMPARTILHAMENTO */
        #share-modal {
            display: none; position: fixed; inset: 0; z-index: 100;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            align-items: center; justify-content: center; padding: 20px;
        }
        #share-modal.active { display: flex; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>

<body class="flex flex-col md:flex-row min-h-screen overflow-y-auto md:overflow-hidden md:h-screen">

    <div id="share-modal">
        <div class="bg-[#1a1a1a] border border-white/10 rounded-2xl p-6 w-full max-w-sm shadow-2xl relative">
            <button onclick="document.getElementById('share-modal').classList.remove('active')" class="absolute top-3 right-3 text-gray-500 hover:text-white p-2">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            
            <div class="text-center mb-4">
                <div class="w-12 h-12 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-3 text-green-500">
                    <i class="fa-solid fa-link text-xl"></i>
                </div>
                <h3 class="text-lg font-bold text-white">Seu Link está Pronto!</h3>
                <p class="text-xs text-gray-400 mt-1">Copie o link abaixo para enviar.</p>
            </div>

            <div class="bg-black/50 rounded-lg p-2 border border-white/10 flex items-center gap-2 mb-4">
                <input type="text" id="share-input" class="bg-transparent text-white text-xs w-full outline-none px-2" readonly>
            </div>

            <button onclick="app.forceCopy()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition active:scale-95">
                COPIAR LINK
            </button>
        </div>
    </div>

    <aside id="editor-panel" class="w-full md:w-4/12 glass-panel flex flex-col z-20 shadow-2xl relative transition-transform duration-300 h-auto md:h-full shrink-0">
        <div class="p-6 border-b border-white/5 flex justify-between items-center bg-black/20 sticky top-0 z-30 backdrop-blur-md">
            <h1 class="text-xl font-serif italic text-white tracking-wider">Organizze <span class="text-[10px] font-sans not-italic text-gray-500 ml-2">MENU</span></h1>
            <div class="flex gap-2">
                <button onclick="app.reset()" class="text-xs text-red-400/80 hover:text-red-400 px-2 py-2 rounded transition"><i class="fa-solid fa-rotate-right"></i></button>
                <button onclick="app.downloadPlaque()" class="bg-white text-black px-4 py-2 rounded-lg text-xs font-bold shadow hover:bg-gray-200 transition active:scale-95 flex items-center gap-2">
                    <i class="fa-solid fa-download"></i> Placa PNG
                </button>
            </div>
        </div>

        <div class="flex-1 md:overflow-y-auto custom-scroll p-6 space-y-8">
            <section class="space-y-3">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em]">Cores</h3>
                <div class="grid grid-cols-3 gap-3">
                    <div class="relative group cursor-pointer">
                        <label class="block text-[9px] text-gray-400 mb-1 text-center">Fundo</label>
                        <div class="h-10 rounded-lg border border-white/10 overflow-hidden relative"><input type="color" id="col-bg" class="absolute -top-2 -left-2 w-16 h-16 cursor-pointer" value="#0f0f11" oninput="app.updateField('colors.bg', this.value)"></div>
                    </div>
                    <div class="relative group cursor-pointer">
                        <label class="block text-[9px] text-gray-400 mb-1 text-center">Texto</label>
                        <div class="h-10 rounded-lg border border-white/10 overflow-hidden relative"><input type="color" id="col-text" class="absolute -top-2 -left-2 w-16 h-16 cursor-pointer" value="#e2e8f0" oninput="app.updateField('colors.text', this.value)"></div>
                    </div>
                    <div class="relative group cursor-pointer">
                        <label class="block text-[9px] text-gray-400 mb-1 text-center">Destaque</label>
                        <div class="h-10 rounded-lg border border-white/10 overflow-hidden relative"><input type="color" id="col-accent" class="absolute -top-2 -left-2 w-16 h-16 cursor-pointer" value="#d4af37" oninput="app.updateField('colors.accent', this.value)"></div>
                    </div>
                </div>
            </section>

            <section class="space-y-4">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em]">Identidade</h3>
                <div class="flex gap-4 items-center">
                    <div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center overflow-hidden border border-white/10 relative group shrink-0">
                        <img id="thumb-logo" class="w-full h-full object-cover hidden">
                        <i id="icon-logo" class="fa-solid fa-camera text-gray-500 group-hover:text-white transition"></i>
                        <input type="file" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" onchange="app.handleLogo(this)">
                    </div>
                    <div class="flex-1 space-y-2">
                        <input type="text" id="inp-name" class="input-dark w-full rounded px-3 py-2 text-sm font-serif" placeholder="Nome do Restaurante" oninput="app.updateField('name', this.value)">
                        <input type="text" id="inp-desc" class="input-dark w-full rounded px-3 py-2 text-xs" placeholder="Slogan ou Horário" oninput="app.updateField('desc', this.value)">
                    </div>
                </div>
            </section>

            <section>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em]">Cardápio</h3>
                    <button onclick="app.addCat()" class="text-[10px] bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full transition">+ Sessão</button>
                </div>
                <div id="editor-list" class="space-y-4"></div>
            </section>
            <div class="h-4"></div>
        </div>

        <div class="p-4 bg-black/40 border-t border-white/5 md:sticky md:bottom-0">
            <button onclick="app.openShare()" class="w-full py-3 rounded-xl font-bold border border-blue-500/30 bg-blue-600/20 hover:bg-blue-600 hover:text-white text-blue-400 transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-share-from-square"></i> COMPARTILHAR LINK
            </button>
        </div>
    </aside>

    <main id="main-view" class="w-full md:flex-1 flex items-center justify-center p-4 bg-[#0a0a0a] relative transition-all duration-500 min-h-[850px] md:min-h-0 md:h-full">
        <div class="absolute inset-0 overflow-hidden opacity-30 pointer-events-none sticky top-0 h-screen">
            <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-purple-900/20 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-blue-900/20 rounded-full blur-[100px]"></div>
        </div>

        <div id="device" class="phone-frame transition-all duration-500">
            <div id="device-notch" class="notch"></div>
            <div id="app-screen" class="w-full h-full relative overflow-hidden flex flex-col">
                <div id="app-bg-anim" class="absolute inset-0 z-0 pointer-events-none overflow-hidden">
                    <div class="orb w-64 h-64 top-[-50px] left-[-50px] animate-float-slow" id="orb-1"></div>
                    <div class="orb w-48 h-48 bottom-[10%] right-[-20px] animate-float-slow" id="orb-2"></div>
                </div>
                <div class="relative z-10 w-full h-full overflow-y-auto custom-scroll px-6 py-12 flex flex-col">
                    <div class="text-center mb-10 mt-6">
                        <div class="w-24 h-24 mx-auto mb-4 rounded-full p-0.5 border border-current opacity-80" id="logo-border">
                            <img id="view-logo" src="" class="w-full h-full rounded-full object-cover hidden">
                            <div id="view-logo-ph" class="w-full h-full rounded-full bg-white/10 flex items-center justify-center"><i class="fa-solid fa-utensils text-2xl opacity-50"></i></div>
                        </div>
                        <h2 id="view-name" class="text-2xl font-serif font-bold tracking-wide mb-1">Nome</h2>
                        <p id="view-desc" class="text-xs font-light tracking-widest uppercase opacity-70">Slogan</p>
                    </div>
                    <div id="view-list" class="space-y-10 pb-20"></div>
                    <div class="mt-auto pt-10 text-center opacity-30 pb-4">
                        <div class="w-1 h-1 bg-current rounded-full mx-auto mb-2"></div>
                        <p class="text-[8px] uppercase tracking-[0.3em]">Menu Digital</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="qr-hidden"></div>

    <script>
        const PRODUCTION_URL = "https://organizze-neon.vercel.app/menu.html";
        
               // --- ESTADO PADRÃO ---
        const defaultState = {
            biz: {
                name: 'Adicionar Negócio',
                desc: 'Descrição',
                colors: {
                    bg: '#0f0f11',      // Cor de Fundo
                    text: '#e2e8f0',    // Cor das Letras
                    accent: '#d4af37'   // Cor de Destaque
                }
            },
            logo: null,
            menu: [
                {
                    id: 1, name: 'Destaques',
                    items: [
                        { name: 'Seu Item', desc: 'Descrição', price: '72' },
                    ]
                }
            ]
        };


        let state = JSON.parse(JSON.stringify(defaultState));
        let isClient = false;

        const app = {
            init: () => {
                const hash = window.location.hash.substring(1);
                if(hash.length > 5) {
                    try {
                        const json = LZString.decompressFromEncodedURIComponent(hash);
                        if(json) { state = JSON.parse(json); isClient = true; app.enableClientMode(); }
                    } catch(e) {}
                } else {
                    const saved = localStorage.getItem('organizze_menu_data');
                    if(saved) state = {...defaultState, ...JSON.parse(saved)};
                }
                if(!isClient) app.renderEditor();
                app.renderPreview();
            },

            enableClientMode: () => {
                document.getElementById('editor-panel').classList.add('hidden');
                const main = document.getElementById('main-view');
                main.className = "fixed inset-0 w-screen h-screen bg-black z-50 flex items-center justify-center p-0";
                const dev = document.getElementById('device');
                dev.style.width = '100%'; dev.style.height = '100%'; dev.style.borderRadius = '0'; dev.style.border = 'none'; dev.style.boxShadow = 'none';
                document.getElementById('device-notch').style.display = 'none';
                document.body.style.backgroundColor = state.biz.colors.bg;
                document.body.style.overflow = "hidden";
            },

            updateField: (path, val) => {
                if(path.includes('.')) { const [p1, p2] = path.split('.'); state.biz[p1][p2] = val; } 
                else { state.biz[path] = val; }
                app.persist(); app.renderPreview();
            },

            handleLogo: (input) => {
                const f = input.files[0]; if (!f) return;
                const r = new FileReader();
                r.onload = (e) => {
                    const img = new Image(); img.onload = () => {
                        const c = document.createElement('canvas'); const ctx = c.getContext('2d');
                        const max = 250; let w=img.width, h=img.height;
                        if(w>h){if(w>max){h*=max/w;w=max}}else{if(h>max){w*=max/h;h=max}}
                        c.width=w; c.height=h; ctx.drawImage(img,0,0,w,h);
                        state.logo = c.toDataURL('image/png'); app.saveRefresh();
                    }; img.src = e.target.result;
                }; r.readAsDataURL(f);
            },

            addCat: () => { state.menu.push({name:'Nova Seção', items:[]}); app.saveRefresh(); },
            delCat: (i) => { if(confirm('Apagar?')) {state.menu.splice(i,1); app.saveRefresh();} },
            upCat: (i,v) => { state.menu[i].name=v; app.persist(); app.renderPreview(); },
            addItem: (i) => { state.menu[i].items.push({name:'',desc:'',price:''}); app.saveRefresh(); },
            delItem: (ci,ii) => { state.menu[ci].items.splice(ii,1); app.saveRefresh(); },
            upItem: (ci,ii,k,v) => { state.menu[ci].items[ii][k]=v; app.persist(); app.renderPreview(); },
            
            persist: () => { if(!isClient) localStorage.setItem('organizze_menu_data', JSON.stringify(state)); },
            saveRefresh: () => { app.persist(); app.renderEditor(); app.renderPreview(); },
            reset: () => { if(confirm('Resetar?')) { localStorage.removeItem('organizze_menu_data'); location.reload(); }},

            getLink: () => {
                const c = LZString.compressToEncodedURIComponent(JSON.stringify(state));
                return PRODUCTION_URL + '#' + c;
            },

            // --- SISTEMA DE CÓPIA FORCE-BRUTE ---
            openShare: () => {
                const url = app.getLink();
                const modal = document.getElementById('share-modal');
                const input = document.getElementById('share-input');
                input.value = url;
                modal.classList.add('active');
            },

            forceCopy: () => {
                const text = document.getElementById('share-input').value;
                
                // 1. Tenta API moderna
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        alert("Copiado com sucesso!");
                    }).catch(err => {
                        app.legacyCopy(text); // Fallback se falhar
                    });
                } else {
                    app.legacyCopy(text); // Fallback direto
                }
            },

            legacyCopy: (text) => {
                // 2. Método "Nuclear" (Textarea Hack) para celulares antigos
                const textArea = document.createElement("textarea");
                textArea.value = text;
                
                // Estilos para esconder mas manter funcional
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                textArea.style.top = "0";
                document.body.appendChild(textArea);
                
                textArea.focus();
                textArea.select();
                
                // Hack específico para iOS
                try {
                    const range = document.createRange();
                    range.selectNodeContents(textArea);
                    const sel = window.getSelection();
                    sel.removeAllRanges();
                    sel.addRange(range);
                    textArea.setSelectionRange(0, 999999);
                } catch(e) {}

                try {
                    const successful = document.execCommand('copy');
                    if(successful) alert("Link copiado!");
                    else prompt("Seu navegador bloqueou a cópia automática. Copie abaixo:", text);
                } catch (err) {
                    prompt("Copie o link manualmente:", text);
                }
                
                document.body.removeChild(textArea);
            },

            renderEditor: () => {
                document.getElementById('inp-name').value = state.biz.name;
                document.getElementById('inp-desc').value = state.biz.desc;
                document.getElementById('col-bg').value = state.biz.colors.bg;
                document.getElementById('col-text').value = state.biz.colors.text;
                document.getElementById('col-accent').value = state.biz.colors.accent;
                
                const vl = document.getElementById('thumb-logo'), vi = document.getElementById('icon-logo');
                if(state.logo) { vl.src=state.logo; vl.classList.remove('hidden'); vi.classList.add('hidden'); }
                else { vl.classList.add('hidden'); vi.classList.remove('hidden'); }

                const el = document.getElementById('editor-list'); el.innerHTML='';
                state.menu.forEach((cat, ci) => {
                    const div = document.createElement('div');
                    div.className = "bg-white/5 border border-white/5 rounded-xl p-3";
                    div.innerHTML = `
                        <div class="flex justify-between mb-2 pb-2 border-b border-white/5">
                            <input type="text" value="${cat.name}" class="bg-transparent text-white font-serif font-bold w-2/3 outline-none" oninput="app.upCat(${ci},this.value)">
                            <button onclick="app.delCat(${ci})" class="text-white/20 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                        </div>
                        <div id="items-${ci}" class="space-y-2"></div>
                        <button onclick="app.addItem(${ci})" class="mt-3 w-full py-1.5 border border-dashed border-gray-600 text-[10px] text-gray-400 rounded hover:border-white hover:text-white transition">+ Item</button>
                    `;
                    const idiv = div.querySelector(`#items-${ci}`);
                    cat.items.forEach((it, ii) => {
                        const row = document.createElement('div');
                        row.className = "flex gap-2 items-start";
                        row.innerHTML = `
                            <div class="flex-1 space-y-1">
                                <input type="text" value="${it.name}" placeholder="Nome" class="w-full bg-transparent text-sm text-white outline-none" oninput="app.upItem(${ci},${ii},'name',this.value)">
                                <input type="text" value="${it.desc}" placeholder="Descrição" class="w-full bg-transparent text-[10px] text-gray-500 outline-none" oninput="app.upItem(${ci},${ii},'desc',this.value)">
                            </div>
                            <div class="w-12">
                                <input type="text" value="${it.price}" placeholder="$" class="w-full bg-transparent text-sm text-right text-yellow-500 outline-none" oninput="app.upItem(${ci},${ii},'price',this.value)">
                            </div>
                            <button onclick="app.delItem(${ci},${ii})" class="text-gray-600 hover:text-red-400 text-xs"><i class="fa-solid fa-xmark"></i></button>
                        `; idiv.appendChild(row);
                    });
                    el.appendChild(div);
                });
            },

            renderPreview: () => {
                const s = state.biz.colors;
                const screen = document.getElementById('app-screen');
                screen.style.backgroundColor = s.bg;
                const orbs = document.querySelectorAll('.orb'); orbs.forEach(o => o.style.backgroundColor = s.accent);

                document.getElementById('view-name').innerText = state.biz.name;
                document.getElementById('view-name').style.color = s.accent;
                document.getElementById('view-desc').innerText = state.biz.desc;
                document.getElementById('view-desc').style.color = s.text;
                document.getElementById('logo-border').style.color = s.accent;
                
                const vl = document.getElementById('view-logo'), vp = document.getElementById('view-logo-ph');
                if(state.logo) { vl.src=state.logo; vl.classList.remove('hidden'); vp.classList.add('hidden'); }
                else { vl.classList.add('hidden'); vp.classList.remove('hidden'); vp.style.color = s.text; }

                const list = document.getElementById('view-list'); list.innerHTML='';
                state.menu.forEach((cat, idx) => {
                    if(!cat.items.length) return;
                    const sec = document.createElement('div');
                    sec.className = "animate-fade-in-up"; sec.style.animationDelay = `${idx*100}ms`;
                    sec.innerHTML = `<h3 class="text-xl font-serif italic mb-5 border-b border-white/5 pb-2" style="color:${s.accent}; border-color:${s.accent}30">${cat.name}</h3>`;
                    const grid = document.createElement('div'); grid.className = "space-y-6";
                    cat.items.forEach(it => {
                        grid.innerHTML += `
                            <div class="flex justify-between items-baseline group">
                                <div class="pr-4 flex-1">
                                    <h4 class="font-medium text-base tracking-wide" style="color:${s.text}">${it.name}</h4>
                                    <p class="text-[11px] font-light mt-1 opacity-70 leading-relaxed" style="color:${s.text}">${it.desc}</p>
                                </div>
                                <div class="font-serif text-lg font-bold whitespace-nowrap" style="color:${s.accent}">${it.price}</div>
                            </div>
                        `;
                    });
                    sec.appendChild(grid); list.appendChild(sec);
                });
            },

            downloadPlaque: () => {
                const url = app.getLink();
                const qc = document.getElementById('qr-hidden'); qc.innerHTML = '';
                new QRCode(qc, { text: url, width: 800, height: 800, colorDark : "#000000", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });

                setTimeout(() => {
                    let qrSource = qc.querySelector('canvas') || qc.querySelector('img');
                    let qrDataURL = qrSource ? (qrSource.src || qrSource.toDataURL()) : null;
                    if (!qrDataURL) return alert('Erro ao gerar QR Code.');

                    const imgObj = new Image();
                    imgObj.onload = () => {
                        const cvs = document.createElement('canvas'); const ctx = cvs.getContext('2d');
                        cvs.width = 1200; cvs.height = 1800;
                        ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,cvs.width,cvs.height);
                        const accent = state.biz.colors.accent; const dark = '#1a1a1a';

                        ctx.strokeStyle = accent; ctx.lineWidth = 15; ctx.strokeRect(40,40,cvs.width-80,cvs.height-80);
                        ctx.lineWidth = 2; ctx.strokeRect(70,70,cvs.width-140,cvs.height-140);
                        ctx.textAlign = 'center';
                        
                        ctx.fillStyle = dark; ctx.font = 'bold 90px "Playfair Display"'; ctx.fillText("MENU DIGITAL", cvs.width/2, 280);
                        ctx.fillStyle = accent; ctx.font = 'italic 50px "Playfair Display"'; ctx.fillText(state.biz.name, cvs.width/2, 380);

                        const qs = 800; ctx.drawImage(imgObj, (cvs.width/2)-(qs/2), 550, qs, qs);

                        ctx.fillStyle = dark; ctx.font = '500 40px "Outfit"'; ctx.fillText("Aponte a câmera do seu celular", cvs.width/2, 1450);
                        
                        const link = document.createElement('a');
                        link.download = `Placa_${state.biz.name.replace(/\s/g,'_')}.png`;
                        link.href = cvs.toDataURL('image/png'); link.click();
                    };
                    imgObj.src = qrDataURL;
                }, 500);
            }
        };

        app.init();
    </script>
</body>
</html>